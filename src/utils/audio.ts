import { Audio } from 'expo-av';

const SOUND_FILES: Record<string, any> = {
  click: require('../../assets/sounds/click.mp3'),
  clickA: require('../../assets/sounds/clickA.mp3'),
  levelUp: require('../../assets/sounds/level-up.mp3'),
  equip: require('../../assets/sounds/equip.mp3'),
  error: require('../../assets/sounds/error.mp3'),
  loginSuccess: require('../../assets/sounds/loginsuccess.mp3'),
  purchaseSuccess: require('../../assets/sounds/purchasesuccess.mp3'),
  activation: require('../../assets/sounds/activation.mp3'),
};

export type SoundKey = keyof typeof SOUND_FILES;

export const playHunterSound = async (soundKey: SoundKey) => {
  try {
    // Configure audio to play even in silent mode on iOS if needed
    await Audio.setAudioModeAsync({
      playsInSilentModeIOS: true,
      staysActiveInBackground: false,
      shouldDuckAndroid: true,
    });

    const { sound } = await Audio.Sound.createAsync(
      SOUND_FILES[soundKey],
      { shouldPlay: true }
    );
    
    // Unload from memory once finished to keep the system fast
    sound.setOnPlaybackStatusUpdate((status) => {
      if (status.isLoaded && status.didJustFinish) {
        sound.unloadAsync();
      }
    });
  } catch (error) {
    console.log(`[Hunter Audio] Failed to play ${soundKey}:`, error);
  }
};
